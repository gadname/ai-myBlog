---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getBlogs } from '../lib/microcms';
import FormattedDate from '../components/FormattedDate.astro';

// 最新のブログ記事を取得
const response = await getBlogs({
	limit: 12,
	orders: '-publishedAt'
});
const recentPosts = response.contents;
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			/* Main Layout */
			.main-wrapper {
				background: #f8f9fa;
				min-height: 100vh;
			}
			
			.main-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: var(--space-2xl) var(--space-xl);
				display: grid;
				grid-template-columns: 1fr 320px;
				gap: var(--space-3xl);
				align-items: start;
			}
			
			/* Content Area */
			.content-area {
				min-width: 0;
			}
			
			/* Posts Grid */
			.posts-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
				gap: var(--space-xl);
			}
			
			.post-card {
				background: rgb(var(--white));
				border-radius: var(--radius-lg);
				overflow: hidden;
				transition: all var(--transition-base);
				text-decoration: none;
				display: flex;
				flex-direction: column;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
				border: 1px solid rgba(0, 0, 0, 0.06);
			}
			
			.post-card:hover {
				transform: translateY(-4px);
				box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
			}
			
			.post-thumbnail {
				aspect-ratio: 16 / 9;
				overflow: hidden;
				background: #e9ecef;
				position: relative;
			}
			
			.post-thumbnail img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				transition: transform var(--transition-slow);
			}
			
			.post-card:hover .post-thumbnail img {
				transform: scale(1.05);
			}
			
			.post-category-tag {
				position: absolute;
				top: var(--space-md);
				left: var(--space-md);
				padding: var(--space-xs) var(--space-md);
				background: #79b8b1;
				color: white;
				font-size: var(--font-size-xs);
				font-weight: 600;
				border-radius: var(--radius-sm);
				text-transform: uppercase;
				letter-spacing: 0.05em;
			}
			
			.post-content {
				padding: var(--space-lg);
				flex: 1;
				display: flex;
				flex-direction: column;
			}
			
			.post-title {
				font-size: var(--font-size-base);
				font-weight: 700;
				color: var(--text-primary);
				margin-bottom: var(--space-sm);
				line-height: var(--line-height-snug);
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
			}
			
			.post-meta {
				margin-top: auto;
				display: flex;
				align-items: center;
				gap: var(--space-sm);
				color: var(--text-muted);
				font-size: var(--font-size-xs);
			}
			
			.post-date {
				display: flex;
				align-items: center;
				gap: var(--space-xs);
			}
			
			/* Sidebar */
			.sidebar {
				position: sticky;
				top: calc(60px + var(--space-2xl));
			}
			
			/* Profile Card */
			.profile-card {
				background: rgb(var(--white));
				border-radius: var(--radius-lg);
				padding: var(--space-xl);
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
				border: 1px solid rgba(0, 0, 0, 0.06);
			}
			
			.profile-header {
				display: flex;
				align-items: center;
				gap: var(--space-lg);
				margin-bottom: var(--space-lg);
			}
			
			.profile-avatar {
				width: 64px;
				height: 64px;
				border-radius: var(--radius-full);
				overflow: hidden;
				flex-shrink: 0;
			}
			
			.profile-avatar img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}
			
			.profile-info {
				flex: 1;
			}
			
			.profile-name {
				font-size: var(--font-size-lg);
				font-weight: 700;
				margin-bottom: var(--space-xs);
				color: var(--text-primary);
			}
			
			.profile-company {
				font-size: var(--font-size-sm);
				color: var(--text-secondary);
			}
			
			.profile-bio {
				font-size: var(--font-size-sm);
				line-height: var(--line-height-relaxed);
				color: var(--text-secondary);
				margin-bottom: var(--space-lg);
			}
			
			.profile-stats {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: var(--space-md);
				padding: var(--space-lg) 0;
				border-top: 1px solid rgba(var(--gray-200), 0.5);
				border-bottom: 1px solid rgba(var(--gray-200), 0.5);
				margin-bottom: var(--space-lg);
			}
			
			.stat-item {
				text-align: center;
			}
			
			.stat-value {
				font-size: var(--font-size-xl);
				font-weight: 700;
				color: var(--text-primary);
				display: block;
			}
			
			.stat-label {
				font-size: var(--font-size-xs);
				color: var(--text-muted);
				text-transform: uppercase;
				letter-spacing: 0.05em;
			}
			
			.social-links {
				display: flex;
				gap: var(--space-sm);
			}
			
			.social-link {
				flex: 1;
				padding: var(--space-sm) var(--space-md);
				border-radius: var(--radius-md);
				font-size: var(--font-size-sm);
				font-weight: 600;
				text-align: center;
				text-decoration: none;
				transition: all var(--transition-base);
			}
			
			.twitter-link {
				background: #1DA1F2;
				color: white;
			}
			
			.twitter-link:hover {
				background: #1a8cd8;
				transform: translateY(-2px);
			}
			
			.github-link {
				background: #333;
				color: white;
			}
			
			.github-link:hover {
				background: #000;
				transform: translateY(-2px);
			}
			
			/* Categories */
			.categories-card {
				background: rgb(var(--white));
				border-radius: var(--radius-lg);
				padding: var(--space-xl);
				margin-top: var(--space-xl);
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
				border: 1px solid rgba(0, 0, 0, 0.06);
			}
			
			.categories-title {
				font-size: var(--font-size-base);
				font-weight: 700;
				margin-bottom: var(--space-lg);
				color: var(--text-primary);
			}
			
			.category-tags {
				display: flex;
				flex-wrap: wrap;
				gap: var(--space-sm);
			}
			
			.category-tag {
				padding: var(--space-xs) var(--space-md);
				background: #f0f0f0;
				color: var(--text-secondary);
				font-size: var(--font-size-sm);
				border-radius: var(--radius-full);
				text-decoration: none;
				transition: all var(--transition-base);
			}
			
			.category-tag:hover {
				background: #79b8b1;
				color: white;
				transform: translateY(-2px);
			}
			
			/* Empty State */
			.empty-state {
				grid-column: 1 / -1;
				text-align: center;
				padding: var(--space-4xl);
				color: var(--text-secondary);
			}
			
			/* Responsive */
			@media (max-width: 1024px) {
				.main-container {
					grid-template-columns: 1fr;
				}
				
				.sidebar {
					position: static;
					order: -1;
					margin-bottom: var(--space-2xl);
				}
				
				.profile-card {
					max-width: 500px;
					margin: 0 auto;
				}
			}
			
			@media (max-width: 768px) {
				.main-container {
					padding: var(--space-lg);
				}
				
				.posts-grid {
					grid-template-columns: 1fr;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		
		<div class="main-wrapper">
			<div class="main-container">
				<!-- Content Area -->
				<main class="content-area">
					<div class="posts-grid">
						{recentPosts.length > 0 ? (
							recentPosts.map((post) => (
								<a href={`/blog/${post.slug}/`} class="post-card">
									<div class="post-thumbnail">
										{post.heroImage ? (
											<img
												src={post.heroImage.url + '?w=560&h=315&fit=crop'}
												alt={post.title}
												loading="lazy"
											/>
										) : (
											<img
												src="https://placehold.co/560x315/e9ecef/6c757d?text=No+Image"
												alt="No image"
											/>
										)}
										{post.category && (
											<span class="post-category-tag">{post.category.name}</span>
										)}
									</div>
									<div class="post-content">
										<h2 class="post-title">{post.title}</h2>
										<div class="post-meta">
											<span class="post-date">
												<svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
													<path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zM4 8h12v8H4V8z" clip-rule="evenodd"/>
												</svg>
												<FormattedDate date={new Date(post.publishedAt)} />
											</span>
										</div>
									</div>
								</a>
							))
						) : (
							<div class="empty-state">
								<p>まだ記事がありません。</p>
							</div>
						)}
					</div>
				</main>
				
				<!-- Sidebar -->
				<aside class="sidebar">
					<!-- Profile Card -->
					<div class="profile-card">
						<div class="profile-header">
							<div class="profile-avatar">
								<img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=128&h=128&fit=crop" alt="プロフィール画像" />
							</div>
							<div class="profile-info">
								<h2 class="profile-name">山田 太郎</h2>
								<p class="profile-company">Tech Company Inc.</p>
							</div>
						</div>
						
						<p class="profile-bio">
							フルスタック開発者として、最新のWeb技術を使用して革新的なソリューションを構築しています。
							インフラからフロントエンドまで幅広く対応。
						</p>
						
						<div class="profile-stats">
							<div class="stat-item">
								<span class="stat-value">150</span>
								<span class="stat-label">記事</span>
							</div>
							<div class="stat-item">
								<span class="stat-value">2.5k</span>
								<span class="stat-label">フォロワー</span>
							</div>
							<div class="stat-item">
								<span class="stat-value">10+</span>
								<span class="stat-label">年の経験</span>
							</div>
						</div>
						
						<div class="social-links">
							<a href="https://twitter.com" target="_blank" class="social-link twitter-link">
								Twitter
							</a>
							<a href="https://github.com" target="_blank" class="social-link github-link">
								GitHub
							</a>
						</div>
					</div>
					
					<!-- Categories -->
					<div class="categories-card">
						<h3 class="categories-title">カテゴリー</h3>
						<div class="category-tags">
							<a href="/blog/category/infrastructure" class="category-tag">インフラ</a>
							<a href="/blog/category/programming" class="category-tag">プログラミング</a>
							<a href="/blog/category/career" class="category-tag">キャリア</a>
							<a href="/blog/category/design" class="category-tag">デザイン</a>
							<a href="/blog/category/business" class="category-tag">ビジネス</a>
							<a href="/blog/category/life" class="category-tag">ライフ</a>
						</div>
					</div>
				</aside>
			</div>
		</div>
		
		<Footer />
	</body>
</html>